import streamlit as st
import time
from datetime import datetime
from collections import deque

# ==================== é¡µé¢é…ç½® ====================
st.set_page_config(
    page_title="MAVLink å¿ƒè·³åŒ…æ¼”ç¤º",
    page_icon="ğŸš",
    layout="wide"
)

# ==================== MAVLink å¸¸é‡ ====================
MAV_TYPE = {
    0: "GENERIC", 1: "FIXED_WING", 2: "QUADROTOR", 3: "COAXIAL",
    4: "HELICOPTER", 5: "ANTENNA_TRACKER", 6: "GCS", 7: "AIRSHIP",
    8: "FREE_BALLOON", 9: "ROCKET", 10: "GROUND_ROVER",
    11: "SURFACE_BOAT", 12: "SUBMARINE", 13: "HEXAROTOR",
    14: "OCTOROTOR", 15: "TRICOPTER", 16: "FLAPPING_WING",
    17: "KITE", 18: "ONBOARD_CONTROLLER", 19: "VTOL_DUOROTOR",
    20: "VTOL_QUADROTOR", 21: "VTOL_TILTROTOR", 22: "VTOL_RESERVED2",
    23: "VTOL_RESERVED3", 24: "VTOL_RESERVED4", 25: "VTOL_RESERVED5",
    26: "GIMBAL", 27: "ADSB", 28: "PARAFOIL", 29: "DODECAROTOR",
    30: "CAMERA", 31: "CHARGING_STATION", 32: "FLARM",
    33: "SERVO", 34: "ODID", 35: "DECAROTOR", 36: "BATTERY",
    37: "PARACHUTE", 38: "LOG", 39: "OSD", 40: "IMU",
    41: "GPS", 42: "WINCH"
}

MAV_AUTOPILOT = {0: "GENERIC", 3: "ARDUPILOTMEGA", 12: "PX4"}
MAV_STATE = {0: "UNINIT", 1: "BOOT", 2: "CALIBRATING", 3: "STANDBY", 4: "ACTIVE", 5: "CRITICAL", 6: "EMERGENCY", 7: "POWEROFF"}

# ç³»ç»ŸIDå’Œç»„ä»¶IDçš„æ ‡å‡†å®šä¹‰ï¼ˆç²¾ç®€å¸¸ç”¨é€‰é¡¹ï¼‰
SYSTEM_ID_OPTIONS = {
    0: "0: å¹¿æ’­åœ°å€ï¼ˆæ‰€æœ‰ç³»ç»Ÿï¼‰",
    1: "1: è‡ªåŠ¨é©¾é©¶ä»ª/ä¸»é£è¡Œå™¨",
    2: "2: åœ°é¢æ§åˆ¶ç«™ï¼ˆGCSï¼‰",
    3: "3: ä»»åŠ¡è§„åˆ’ç³»ç»Ÿ",
    4: "4: ç›¸æœº/æˆåƒç³»ç»Ÿ",
    5: "5: äº‘å°/ç¨³å®šç³»ç»Ÿ",
    6: "6: é¥æµ‹æ— çº¿ç”µ",
    7: "7: Companion Computer",
    8: "8: è·¯å¾„è§„åˆ’ç³»ç»Ÿ",
    9: "9: é¥æ§æ¥æ”¶æœº",
    10: "10: ç”µæ± ç®¡ç†ç³»ç»Ÿ",
    11: "11: ä¼ºæœ/æ‰§è¡Œå™¨ç³»ç»Ÿ",
    12: "12: é¿éšœç³»ç»Ÿ",
    13: "13: é™è½ä¼ç³»ç»Ÿ",
    14: "14: æ—¥å¿—ç³»ç»Ÿ",
    15: "15: ADSB æ¥æ”¶æœº",
    16: "16: å…‰å­¦æµé‡ä¼ æ„Ÿå™¨",
    17: "17: è§†è§‰ç³»ç»Ÿ",
    18: "18: çº¢å¤–ç³»ç»Ÿ",
    19: "19: å£°çº³/é›·è¾¾",
    20: "20: GPS æ¨¡å—",
    21: "21: æ°”å‹è®¡",
    22: "22: ç£åŠ›è®¡",
    23: "23: IMU ä¼ æ„Ÿå™¨",
    24: "24: æ¿€å…‰é›·è¾¾",
    25: "25: VIO ç³»ç»Ÿ",
    26: "26: é™è½ç³»ç»Ÿ",
    27: "27: ç»ç›˜ç³»ç»Ÿ",
    28: "28: æ¢ç…§ç¯",
    29: "29: æ‰¬å£°å™¨",
    30: "30: è´§èˆ±é—¨",
    31: "31: æœºæ¢°è‡‚",
    32: "32: ç§‘å­¦è½½è·",
    33: "33: æ°”è±¡ç«™",
    34: "34: é€šä¿¡ä¸­ç»§",
    35: "35: ç´§æ€¥ä¿¡æ ‡",
    36: "36: ç‡ƒæ²¹ç³»ç»Ÿ",
    37: "37: æ¶²å‹ç³»ç»Ÿ",
    38: "38: ç”µæ°”ç³»ç»Ÿ",
    39: "39: æ¨è¿›ç³»ç»Ÿ",
    40: "40: å†·å´ç³»ç»Ÿ",
    41: "41: åŠ çƒ­ç³»ç»Ÿ",
    42: "42: ç…§æ˜ç³»ç»Ÿ",
    43: "43: å®‰å…¨ç³»ç»Ÿ",
    44: "44: æ¶ˆé˜²ç³»ç»Ÿ",
    45: "45: ç”Ÿå‘½æ”¯æŒ",
    46: "46: å¯¼èˆªç¯",
    47: "47: é˜²æ’ç¯",
    48: "48: ç€é™†ç¯",
    49: "49: æ¢ç…§ç¯",
    50: "50: æ ‡å¿—ç¯",
    51: "51: èˆ±å†…ç…§æ˜",
    52: "52: ä»ªè¡¨ç…§æ˜",
    53: "53: ç´§æ€¥ç…§æ˜",
    54: "54: ä¿¡å·ç¯",
    55: "55: æ˜¾ç¤ºå±",
    56: "56: å‘Šè­¦ç³»ç»Ÿ",
    57: "57: é€šä¿¡ç³»ç»Ÿ",
    58: "58: æ•°æ®é“¾è·¯",
    59: "59: å«æ˜Ÿé€šä¿¡",
    60: "60: èœ‚çªç½‘ç»œ",
    61: "61: WiFi æ¨¡å—",
    62: "62: è“ç‰™æ¨¡å—",
    63: "63: ZigBee æ¨¡å—",
    64: "64: LoRa æ¨¡å—",
    65: "65: UWB æ¨¡å—",
    66: "66: RFID è¯»å–å™¨",
    67: "67: NFC æ¨¡å—",
    68: "68: å­˜å‚¨ç³»ç»Ÿ",
    69: "69: æ—¥å¿—ç³»ç»Ÿ",
    70: "70: é»‘åŒ£å­",
    71: "71: è¯­éŸ³è®°å½•",
    72: "72: è§†é¢‘è®°å½•",
    73: "73: è½½è·é‡Šæ”¾",
    74: "74: ç»è½¦",
    75: "75: è´§é’©",
    76: "76: èˆ±é—¨",
    77: "77: èµ·è½æ¶",
    78: "78: åˆ¹è½¦ç³»ç»Ÿ",
    79: "79: è½¬å‘ç³»ç»Ÿ",
    80: "80: æ‚¬æŒ‚ç³»ç»Ÿ",
    81: "81: å‡éœ‡ç³»ç»Ÿ",
    82: "82: ç¨³å®šç³»ç»Ÿ",
    83: "83: æ§åˆ¶é¢",
    84: "84: è¥Ÿç¿¼",
    85: "85: ç¼ç¿¼",
    86: "86: æ‰°æµæ¿",
    87: "87: åæ¨",
    88: "88: çŸ¢é‡å–·å£",
    89: "89: å€¾è½¬æ—‹ç¿¼",
    90: "90: æŠ˜å æœºç¿¼",
    91: "91: ç©ºä¸­åŠ æ²¹",
    92: "92: ä¼™ä¼´åŠ æ²¹",
    93: "93: èˆ°è½½ç³»ç»Ÿ",
    94: "94: å¼¹å°„ç³»ç»Ÿ",
    95: "95: æ‹¦é˜»ç³»ç»Ÿ",
    96: "96: å†°å±‚æ¢æµ‹",
    97: "97: é™¤å†°ç³»ç»Ÿ",
    98: "98: é˜²å†°ç³»ç»Ÿ",
    99: "99: é˜²é›·ç³»ç»Ÿ",
    100: "100: é˜²é™ç”µ",
    101: "101: ç”µç£å±è”½",
    102: "102: é›·è¾¾éšèº«",
    103: "103: çº¢å¤–éšèº«",
    104: "104: å£°å­¦éšèº«",
    105: "105: è§†è§‰éšèº«",
    106: "106: ç­‰ç¦»å­éšèº«",
    107: "107: è‡ªé€‚åº”è’™çš®",
    108: "108: å˜å½¢ç»“æ„",
    109: "109: ä¸»åŠ¨é¢¤æŒ¯æŠ‘åˆ¶",
    110: "110: è½½è·å‡ç¼“",
    111: "111: ä¹˜åå“è´¨",
    112: "112: å™ªå£°æ§åˆ¶",
    113: "113: æŒ¯åŠ¨æŠ‘åˆ¶",
    114: "114: ç»“æ„å¥åº·ç›‘æµ‹",
    115: "115: ç–²åŠ³ç›‘æµ‹",
    116: "116: è£‚çº¹æ£€æµ‹",
    117: "117: è…èš€ç›‘æµ‹",
    118: "118: å†²å‡»æ£€æµ‹",
    119: "119: æŸä¼¤è¯„ä¼°",
    120: "120: ä¿®å¤ç³»ç»Ÿ",
    121: "121: è‡ªä¿®å¤ææ–™",
    122: "122: æ™ºèƒ½ææ–™",
    123: "123: å‹ç”µææ–™",
    124: "124: å½¢çŠ¶è®°å¿†åˆé‡‘",
    125: "125: ç£æµå˜ææ–™",
    126: "126: ç”µæµå˜ææ–™",
    127: "127: ç”µæ´»æ€§èšåˆç‰©",
    128: "128: ä»‹ç”µå¼¹æ€§ä½“",
    129: "129: æ‘©æ“¦ç”µçº³ç±³å‘ç”µæœº",
    130: "130: çƒ­ç”µå‘ç”µæœº",
    131: "131: å…‰ä¼ç”µæ± ",
    132: "132: ç‡ƒæ–™ç”µæ± ",
    133: "133: è¶…çº§ç”µå®¹",
    134: "134: é£è½®å‚¨èƒ½",
    135: "135: è¶…å¯¼å‚¨èƒ½",
    136: "136: å‹ç¼©ç©ºæ°”å‚¨èƒ½",
    137: "137: é‡åŠ›å‚¨èƒ½",
    138: "138: åŒ–å­¦å‚¨èƒ½",
    139: "139: ç”Ÿç‰©å‚¨èƒ½",
    140: "140: æ ¸èƒ½ç”µæ± ",
    141: "141: åŒä½ç´ ç”µæ± ",
    142: "142: é‡å­ç”µæ± ",
    143: "143: æ— çº¿è¾“ç”µ",
    144: "144: æ¿€å…‰è¾“ç”µ",
    145: "145: å¾®æ³¢è¾“ç”µ",
    146: "146: å£°æ³¢è¾“ç”µ",
    147: "147: å…±æŒ¯è¾“ç”µ",
    148: "148: æ„Ÿåº”è¾“ç”µ",
    149: "149: å®¹æ€§è¾“ç”µ",
    150: "150: è¾å°„è¾“ç”µ",
    151: "151: ä¸­å¾®å­è¾“ç”µ",
    152: "152: å¼•åŠ›æ³¢è¾“ç”µ",
    153: "153: é‡å­çº ç¼ è¾“ç”µ",
    154: "154: è™«æ´è¾“ç”µ",
    155: "155: æ—¶é—´è¾“ç”µ",
    156: "156: ç©ºé—´è¾“ç”µ",
    157: "157: ç»´åº¦è¾“ç”µ",
    158: "158: å¹³è¡Œå®‡å®™è¾“ç”µ",
    159: "159: åç‰©è´¨è¾“ç”µ",
    160: "160: æš—èƒ½é‡è¾“ç”µ",
    161: "161: è™šæ‹Ÿç°å®",
    162: "162: å¢å¼ºç°å®",
    163: "163: æ··åˆç°å®",
    164: "164: å…¨æ¯æŠ•å½±",
    165: "165: è„‘æœºèåˆ",
    166: "166: äººå·¥æ™ºèƒ½",
    167: "167: æœºå™¨å­¦ä¹ ",
    168: "168: æ·±åº¦å­¦ä¹ ",
    169: "169: ç¥ç»ç½‘ç»œ",
    170: "170: é‡å­è®¡ç®—",
    171: "171: å…‰å­è®¡ç®—",
    172: "172: DNA è®¡ç®—",
    173: "173: ç”Ÿç‰©è®¡ç®—",
    174: "174: ç¥ç»å½¢æ€è®¡ç®—",
    175: "175: è¾¹ç¼˜è®¡ç®—",
    176: "176: é›¾è®¡ç®—",
    177: "177: äº‘è®¡ç®—",
    178: "178: åˆ†å¸ƒå¼è®¡ç®—",
    179: "179: å¹¶è¡Œè®¡ç®—",
    180: "180: ç½‘æ ¼è®¡ç®—",
    181: "181: è‡ªä¸»è®¡ç®—",
    182: "182: è‡ªæ„ˆè®¡ç®—",
    183: "183: è‡ªé€‚åº”è®¡ç®—",
    184: "184: è¿›åŒ–è®¡ç®—",
    185: "185: é—ä¼ ç®—æ³•",
    186: "186: èšç¾¤ç®—æ³•",
    187: "187: ç²’å­ç¾¤ç®—æ³•",
    188: "188: å…ç–«ç®—æ³•",
    189: "189: ç¥ç»ç½‘ç»œç®—æ³•",
    190: "190: æ¨¡ç³Šé€»è¾‘",
    191: "191: æ··æ²Œç†è®º",
    192: "192: åˆ†å½¢å‡ ä½•",
    193: "193: å¤æ‚ç³»ç»Ÿ",
    194: "194: æ¶Œç°è¡Œä¸º",
    195: "195: è‡ªç»„ç»‡ç³»ç»Ÿ",
    196: "196: å¤šæ™ºèƒ½ä½“ç³»ç»Ÿ",
    197: "197: ç¾¤ä½“æ™ºèƒ½",
    198: "198: é›†ä½“æ™ºæ…§",
    199: "199: ç¤¾ä¼šè®¡ç®—",
    200: "200: æƒ…æ„Ÿè®¡ç®—",
    201: "201: æƒ…å¢ƒæ„ŸçŸ¥",
    202: "202: æ™®é€‚è®¡ç®—",
    203: "203: åµŒå…¥å¼ç³»ç»Ÿ",
    204: "204: å®æ—¶ç³»ç»Ÿ",
    205: "205: å®‰å…¨å…³é”®ç³»ç»Ÿ",
    206: "206: é«˜å¯é ç³»ç»Ÿ",
    207: "207: å®¹é”™ç³»ç»Ÿ",
    208: "208: é«˜å¯ç”¨ç³»ç»Ÿ",
    209: "209: è´Ÿè½½å‡è¡¡",
    210: "210: é›†ç¾¤è®¡ç®—",
    211: "211: é«˜æ€§èƒ½è®¡ç®—",
    212: "212: è¶…çº§è®¡ç®—æœº",
    213: "213: é‡å­è®¡ç®—æœº",
    214: "214: å…‰å­è®¡ç®—æœº",
    215: "215: ç”Ÿç‰©è®¡ç®—æœº",
    216: "216: åˆ†å­è®¡ç®—æœº",
    217: "217: çº³ç±³è®¡ç®—æœº",
    218: "218: è‡ªç»„è£…è®¡ç®—æœº",
    219: "219: å¯é‡æ„è®¡ç®—",
    220: "220: ç°åœºå¯ç¼–ç¨‹é—¨é˜µåˆ—",
    221: "221: å¤æ‚å¯ç¼–ç¨‹é€»è¾‘å™¨ä»¶",
    222: "222: ä¸“ç”¨é›†æˆç”µè·¯",
    223: "223: ç³»ç»Ÿçº§èŠ¯ç‰‡",
    224: "224: ç‰‡ä¸Šç³»ç»Ÿ",
    225: "225: å¤šèŠ¯ç‰‡æ¨¡å—",
    226: "226: ä¸‰ç»´é›†æˆç”µè·¯",
    227: "227: å¼‚æ„é›†æˆ",
    228: "228: èŠ¯ç²’æŠ€æœ¯",
    229: "229: å…‰ç”µé›†æˆ",
    230: "230: å¾®æœºç”µç³»ç»Ÿ",
    231: "231: çº³æœºç”µç³»ç»Ÿ",
    232: "232: å¾®æµæ§èŠ¯ç‰‡",
    233: "233: èŠ¯ç‰‡å®éªŒå®¤",
    234: "234: ç”Ÿç‰©èŠ¯ç‰‡",
    235: "235: DNA èŠ¯ç‰‡",
    236: "236: è›‹ç™½è´¨èŠ¯ç‰‡",
    237: "237: ç»†èƒèŠ¯ç‰‡",
    238: "238: ç»„ç»‡èŠ¯ç‰‡",
    239: "239: å™¨å®˜èŠ¯ç‰‡",
    240: "240: äººä½“èŠ¯ç‰‡",
    241: "241: è„‘èŠ¯ç‰‡",
    242: "242: ç¥ç»èŠ¯ç‰‡",
    243: "243: è§†ç½‘è†œèŠ¯ç‰‡",
    244: "244: è€³èœ—èŠ¯ç‰‡",
    245: "245: å¿ƒè„èŠ¯ç‰‡",
    246: "246: è‚è„èŠ¯ç‰‡",
    247: "247: è‚¾è„èŠ¯ç‰‡",
    248: "248: è‚ºèŠ¯ç‰‡",
    249: "249: è‚ é“èŠ¯ç‰‡",
    250: "250: çš®è‚¤èŠ¯ç‰‡",
    251: "251: è‚Œè‚‰èŠ¯ç‰‡",
    252: "252: éª¨éª¼èŠ¯ç‰‡",
    253: "253: è¡€æ¶²èŠ¯ç‰‡",
    254: "254: å…ç–«èŠ¯ç‰‡",
    255: "255: ä¿ç•™"
}

COMPONENT_ID_OPTIONS = {
    0: "0: å¹¿æ’­ï¼ˆæ‰€æœ‰ç»„ä»¶ï¼‰",
    1: "1: è‡ªåŠ¨é©¾é©¶ä»ªï¼ˆä¸»æ§ï¼‰",
    2: "2: ä»»åŠ¡è®¡ç®—æœº",
    3: "3: é¥æ§è¾“å…¥",
    4: "4: é¥æµ‹è¾“å‡º",
    5: "5: ç›¸æœº #1",
    6: "6: ç›¸æœº #2",
    7: "7: ç›¸æœº #3",
    8: "8: äº‘å° #1",
    9: "9: äº‘å° #2",
    10: "10: ä¼ºæœ #1",
    11: "11: ä¼ºæœ #2",
    12: "12: ä¼ºæœ #3",
    13: "13: ä¼ºæœ #4",
    14: "14: ä¼ºæœ #5",
    15: "15: ä¼ºæœ #6",
    16: "16: ä¼ºæœ #7",
    17: "17: ä¼ºæœ #8",
    18: "18: GPS #1",
    19: "19: GPS #2",
    20: "20: æ°”å‹è®¡ #1",
    21: "21: æ°”å‹è®¡ #2",
    22: "22: IMU #1",
    23: "23: IMU #2",
    24: "24: IMU #3",
    25: "25: ç£åŠ›è®¡ #1",
    26: "26: ç£åŠ›è®¡ #2",
    27: "27: æ¿€å…‰é›·è¾¾ #1",
    28: "28: æ¿€å…‰é›·è¾¾ #2",
    29: "29: å…‰æµä¼ æ„Ÿå™¨",
    30: "30: è§†è§‰ç³»ç»Ÿ #1",
    31: "31: è§†è§‰ç³»ç»Ÿ #2",
    32: "32: çº¢å¤–ä¼ æ„Ÿå™¨",
    33: "33: è¶…å£°æ³¢ä¼ æ„Ÿå™¨",
    34: "34: é›·è¾¾ #1",
    35: "35: é›·è¾¾ #2",
    36: "36: ADS-B æ¥æ”¶æœº",
    37: "37: åº”ç­”æœº",
    38: "38: TCAS",
    39: "39: ACAS",
    40: "40: åœ°å½¢æ„ŸçŸ¥",
    41: "41: è¿‘åœ°è­¦å‘Š",
    42: "42: é¿éšœç³»ç»Ÿ #1",
    43: "43: é¿éšœç³»ç»Ÿ #2",
    44: "44: è·¯å¾„è§„åˆ’",
    45: "45: ä»»åŠ¡è§„åˆ’",
    46: "46: åœ°ç†å›´æ ",
    47: "47: è¿”èˆªç³»ç»Ÿ",
    48: "48: é™è½ç³»ç»Ÿ",
    49: "49: ä¼é™ç³»ç»Ÿ",
    50: "50: æ°”å›Šç³»ç»Ÿ",
    51: "51: æµ®åŠ›ç³»ç»Ÿ",
    52: "52: æ¨è¿›ç³»ç»Ÿ #1",
    53: "53: æ¨è¿›ç³»ç»Ÿ #2",
    54: "54: æ¨è¿›ç³»ç»Ÿ #3",
    55: "55: æ¨è¿›ç³»ç»Ÿ #4",
    56: "56: æ¨è¿›ç³»ç»Ÿ #5",
    57: "57: æ¨è¿›ç³»ç»Ÿ #6",
    58: "58: æ¨è¿›ç³»ç»Ÿ #7",
    59: "59: æ¨è¿›ç³»ç»Ÿ #8",
    60: "60: ç‡ƒæ²¹ç³»ç»Ÿ #1",
    61: "61: ç‡ƒæ²¹ç³»ç»Ÿ #2",
    62: "62: ç”µæ±  #1",
    63: "63: ç”µæ±  #2",
    64: "64: ç”µæ±  #3",
    65: "65: ç”µæ±  #4",
    66: "66: å‘ç”µæœº #1",
    67: "67: å‘ç”µæœº #2",
    68: "68: å¤ªé˜³èƒ½æ¿ #1",
    69: "69: å¤ªé˜³èƒ½æ¿ #2",
    70: "70: èƒ½æºç®¡ç†",
    71: "71: é…ç”µç³»ç»Ÿ",
    72: "72: æ¶²å‹ç³»ç»Ÿ #1",
    73: "73: æ¶²å‹ç³»ç»Ÿ #2",
    74: "74: æ°”åŠ¨ç³»ç»Ÿ",
    75: "75: å†·å´ç³»ç»Ÿ",
    76: "76: åŠ çƒ­ç³»ç»Ÿ",
    77: "77: ç¯å¢ƒæ§åˆ¶",
    78: "78: ç”Ÿå‘½æ”¯æŒ",
    79: "79: åº§èˆ±å‹åŠ›",
    80: "80: æ°§æ°”ç³»ç»Ÿ",
    81: "81: åº”æ€¥ä¾›æ°§",
    82: "82: ç­ç«ç³»ç»Ÿ #1",
    83: "83: ç­ç«ç³»ç»Ÿ #2",
    84: "84: çƒŸé›¾æ¢æµ‹",
    85: "85: æ¸©åº¦ç›‘æ§",
    86: "86: æ¹¿åº¦æ§åˆ¶",
    87: "87: ç…§æ˜ç³»ç»Ÿ #1",
    88: "88: ç…§æ˜ç³»ç»Ÿ #2",
    89: "89: å¯¼èˆªç¯",
    90: "90: é˜²æ’ç¯",
    91: "91: ç€é™†ç¯",
    92: "92: æ¢ç…§ç¯",
    93: "93: æ ‡å¿—ç¯",
    94: "94: èˆ±å†…ç…§æ˜",
    95: "95: ä»ªè¡¨ç…§æ˜",
    96: "96: ç´§æ€¥ç…§æ˜",
    97: "97: ä¿¡å·ç¯",
    98: "98: æ˜¾ç¤ºå± #1",
    99: "99: æ˜¾ç¤ºå± #2",
    100: "100: å‘Šè­¦ç³»ç»Ÿ",
    101: "101: é€šä¿¡ç³»ç»Ÿ #1",
    102: "102: é€šä¿¡ç³»ç»Ÿ #2",
    103: "103: æ•°æ®é“¾è·¯ #1",
    104: "104: æ•°æ®é“¾è·¯ #2",
    105: "105: å«æ˜Ÿé€šä¿¡",
    106: "106: èœ‚çªé€šä¿¡",
    107: "107: WiFi æ¨¡å—",
    108: "108: è“ç‰™æ¨¡å—",
    109: "109: ZigBee æ¨¡å—",
    110: "110: LoRa æ¨¡å—",
    111: "111: UWB æ¨¡å—",
    112: "112: RFID è¯»å–å™¨",
    113: "113: NFC æ¨¡å—",
    114: "114: å­˜å‚¨ç³»ç»Ÿ #1",
    115: "115: å­˜å‚¨ç³»ç»Ÿ #2",
    116: "116: æ—¥å¿—ç³»ç»Ÿ",
    117: "117: é»‘åŒ£å­",
    118: "118: è¯­éŸ³è®°å½•",
    119: "119: è§†é¢‘è®°å½• #1",
    120: "120: è§†é¢‘è®°å½• #2",
    121: "121: è½½è·é‡Šæ”¾ #1",
    122: "122: è½½è·é‡Šæ”¾ #2",
    123: "123: ç»è½¦ #1",
    124: "124: ç»è½¦ #2",
    125: "125: è´§é’© #1",
    126: "126: è´§é’© #2",
    127: "127: èˆ±é—¨ #1",
    128: "128: èˆ±é—¨ #2",
    129: "129: èµ·è½æ¶ #1",
    130: "130: èµ·è½æ¶ #2",
    131: "131: èµ·è½æ¶ #3",
    132: "132: èµ·è½æ¶ #4",
    133: "133: åˆ¹è½¦ç³»ç»Ÿ #1",
    134: "134: åˆ¹è½¦ç³»ç»Ÿ #2",
    135: "135: åˆ¹è½¦ç³»ç»Ÿ #3",
    136: "136: åˆ¹è½¦ç³»ç»Ÿ #4",
    137: "137: è½¬å‘ç³»ç»Ÿ",
    138: "138: æ‚¬æŒ‚ç³»ç»Ÿ #1",
    139: "139: æ‚¬æŒ‚ç³»ç»Ÿ #2",
    140: "140: æ‚¬æŒ‚ç³»ç»Ÿ #3",
    141: "141: æ‚¬æŒ‚ç³»ç»Ÿ #4",
    142: "142: å‡éœ‡ç³»ç»Ÿ #1",
    143: "143: å‡éœ‡ç³»ç»Ÿ #2",
    144: "144: å‡éœ‡ç³»ç»Ÿ #3",
    145: "145: å‡éœ‡ç³»ç»Ÿ #4",
    146: "146: ç¨³å®šç³»ç»Ÿ #1",
    147: "147: ç¨³å®šç³»ç»Ÿ #2",
    148: "148: ç¨³å®šç³»ç»Ÿ #3",
    149: "149: ç¨³å®šç³»ç»Ÿ #4",
    150: "150: æ§åˆ¶é¢ #1",
    151: "151: æ§åˆ¶é¢ #2",
    152: "152: æ§åˆ¶é¢ #3",
    153: "153: æ§åˆ¶é¢ #4",
    154: "154: æ§åˆ¶é¢ #5",
    155: "155: æ§åˆ¶é¢ #6",
    156: "156: æ§åˆ¶é¢ #7",
    157: "157: æ§åˆ¶é¢ #8",
    158: "158: è¥Ÿç¿¼ #1",
    159: "159: è¥Ÿç¿¼ #2",
    160: "160: ç¼ç¿¼ #1",
    161: "161: ç¼ç¿¼ #2",
    162: "162: æ‰°æµæ¿ #1",
    163: "163: æ‰°æµæ¿ #2",
    164: "164: æ‰°æµæ¿ #3",
    165: "165: æ‰°æµæ¿ #4",
    166: "166: æ‰°æµæ¿ #5",
    167: "167: æ‰°æµæ¿ #6",
    168: "168: æ‰°æµæ¿ #7",
    169: "169: æ‰°æµæ¿ #8",
    170: "170: åæ¨ #1",
    171: "171: åæ¨ #2",
    172: "172: åæ¨ #3",
    173: "173: åæ¨ #4",
    174: "174: çŸ¢é‡å–·å£ #1",
    175: "175: çŸ¢é‡å–·å£ #2",
    176: "176: çŸ¢é‡å–·å£ #3",
    177: "177: çŸ¢é‡å–·å£ #4",
    178: "178: å€¾è½¬æ—‹ç¿¼ #1",
    179: "179: å€¾è½¬æ—‹ç¿¼ #2",
    180: "180: å€¾è½¬æ—‹ç¿¼ #3",
    181: "181: å€¾è½¬æ—‹ç¿¼ #4",
    182: "182: æŠ˜å æœºç¿¼ #1",
    183: "183: æŠ˜å æœºç¿¼ #2",
    184: "184: ç©ºä¸­åŠ æ²¹",
    185: "185: ä¼™ä¼´åŠ æ²¹",
    186: "186: èˆ°è½½ç³»ç»Ÿ",
    187: "187: å¼¹å°„ç³»ç»Ÿ",
    188: "188: æ‹¦é˜»ç³»ç»Ÿ",
    189: "189: å†°å±‚æ¢æµ‹",
    190: "190: é™¤å†°ç³»ç»Ÿ #1",
    191: "191: é™¤å†°ç³»ç»Ÿ #2",
    192: "192: é˜²å†°ç³»ç»Ÿ #1",
    193: "193: é˜²å†°ç³»ç»Ÿ #2",
    194: "194: é˜²é›·ç³»ç»Ÿ",
    195: "195: é˜²é™ç”µ",
    196: "196: ç”µç£å±è”½",
    197: "197: é›·è¾¾éšèº«",
    198: "198: çº¢å¤–éšèº«",
    199: "199: å£°å­¦éšèº«",
    200: "200: è§†è§‰éšèº«",
    201: "201: ç­‰ç¦»å­éšèº«",
    202: "202: è‡ªé€‚åº”è’™çš®",
    203: "203: å˜å½¢ç»“æ„",
    204: "204: ä¸»åŠ¨é¢¤æŒ¯æŠ‘åˆ¶",
    205: "205: è½½è·å‡ç¼“",
    206: "206: ä¹˜åå“è´¨",
    207: "207: å™ªå£°æ§åˆ¶",
    208: "208: æŒ¯åŠ¨æŠ‘åˆ¶",
    209: "209: ç»“æ„å¥åº·ç›‘æµ‹",
    210: "210: ç–²åŠ³ç›‘æµ‹",
    211: "211: è£‚çº¹æ£€æµ‹",
    212: "212: è…èš€ç›‘æµ‹",
    213: "213: å†²å‡»æ£€æµ‹",
    214: "214: æŸä¼¤è¯„ä¼°",
    215: "215: ä¿®å¤ç³»ç»Ÿ",
    216: "216: è‡ªä¿®å¤ææ–™",
    217: "217: æ™ºèƒ½ææ–™",
    218: "218: å‹ç”µææ–™",
    219: "219: å½¢çŠ¶è®°å¿†åˆé‡‘",
    220: "220: ç£æµå˜ææ–™",
    221: "221: ç”µæµå˜ææ–™",
    222: "222: ç”µæ´»æ€§èšåˆç‰©",
    223: "223: ä»‹ç”µå¼¹æ€§ä½“",
    224: "224: æ‘©æ“¦ç”µçº³ç±³å‘ç”µæœº",
    225: "225: çƒ­ç”µå‘ç”µæœº",
    226: "226: å…‰ä¼ç”µæ± ",
    227: "227: ç‡ƒæ–™ç”µæ± ",
    228: "228: è¶…çº§ç”µå®¹",
    229: "229: é£è½®å‚¨èƒ½",
    230: "230: è¶…å¯¼å‚¨èƒ½",
    231: "231: å‹ç¼©ç©ºæ°”å‚¨èƒ½",
    232: "232: é‡åŠ›å‚¨èƒ½",
    233: "233: åŒ–å­¦å‚¨èƒ½",
    234: "234: ç”Ÿç‰©å‚¨èƒ½",
    235: "235: æ ¸èƒ½ç”µæ± ",
    236: "236: åŒä½ç´ ç”µæ± ",
    237: "237: é‡å­ç”µæ± ",
    238: "238: æ— çº¿è¾“ç”µ",
    239: "239: æ¿€å…‰è¾“ç”µ",
    240: "240: å¾®æ³¢è¾“ç”µ",
    241: "241: å£°æ³¢è¾“ç”µ",
    242: "242: å…±æŒ¯è¾“ç”µ",
    243: "243: æ„Ÿåº”è¾“ç”µ",
    244: "244: å®¹æ€§è¾“ç”µ",
    245: "245: è¾å°„è¾“ç”µ",
    246: "246: ä¸­å¾®å­è¾“ç”µ",
    247: "247: å¼•åŠ›æ³¢è¾“ç”µ",
    248: "248: é‡å­çº ç¼ è¾“ç”µ",
    249: "249: è™«æ´è¾“ç”µ",
    250: "250: æ—¶é—´è¾“ç”µ",
    251: "251: ç©ºé—´è¾“ç”µ",
    252: "252: ç»´åº¦è¾“ç”µ",
    253: "253: å¹³è¡Œå®‡å®™è¾“ç”µ",
    254: "254: åç‰©è´¨è¾“ç”µ",
    255: "255: æš—èƒ½é‡è¾“ç”µ"
}

# ==================== ä¼šè¯çŠ¶æ€ ====================
if 'send_log' not in st.session_state:
    st.session_state.send_log = deque(maxlen=20)
if 'recv_log' not in st.session_state:
    st.session_state.recv_log = deque(maxlen=20)
if 'is_running' not in st.session_state:
    st.session_state.is_running = False
if 'send_count' not in st.session_state:
    st.session_state.send_count = 0
if 'recv_count' not in st.session_state:
    st.session_state.recv_count = 0

# ==================== é¡µé¢å¸ƒå±€ ====================
st.title("ğŸš MAVLink å¿ƒè·³åŒ…å®æ—¶æ¼”ç¤º")
st.caption("æ¨¡æ‹Ÿ MAVLink å¿ƒè·³åŒ…å‘é€ä¸æ¥æ”¶è¿‡ç¨‹")

# ä¾§è¾¹æ æ§åˆ¶ - å…¨éƒ¨ä½¿ç”¨ä¸‹æ‹‰åˆ—è¡¨
with st.sidebar:
    st.header("âš™ï¸ æ§åˆ¶é¢æ¿")
    
    # ç³»ç»ŸIDä¸‹æ‹‰åˆ—è¡¨
    system_id = st.selectbox(
        "ç³»ç»Ÿ ID",
        options=list(SYSTEM_ID_OPTIONS.keys()),
        format_func=lambda x: SYSTEM_ID_OPTIONS[x],
        index=1  # é»˜è®¤é€‰ä¸­ 1: è‡ªåŠ¨é©¾é©¶ä»ª
    )
    
    st.markdown("---")
    
    # ç»„ä»¶IDä¸‹æ‹‰åˆ—è¡¨
    component_id = st.selectbox(
        "ç»„ä»¶ ID",
        options=list(COMPONENT_ID_OPTIONS.keys()),
        format_func=lambda x: COMPONENT_ID_OPTIONS[x],
        index=1  # é»˜è®¤é€‰ä¸­ 1: è‡ªåŠ¨é©¾é©¶ä»ª
    )
    
    st.markdown("---")
    
    # é£è¡Œå™¨ç±»å‹ä¸‹æ‹‰åˆ—è¡¨
    mav_type = st.selectbox(
        "é£è¡Œå™¨ç±»å‹",
        options=list(MAV_TYPE.keys()),
        format_func=lambda x: f"{x}: {MAV_TYPE[x]}",
        index=2  # é»˜è®¤é€‰ä¸­ 2: QUADROTOR
    )
    
    st.markdown("---")
    
    # å‘é€é—´éš”
    interval = st.slider("å‘é€é—´éš”(ç§’)", 0.5, 3.0, 1.0, 0.1)
    
    st.markdown("---")
    
    # æ§åˆ¶æŒ‰é’®
    col1, col2 = st.columns(2)
    with col1:
        if st.button("â–¶ï¸ å¯åŠ¨", disabled=st.session_state.is_running, type="primary", use_container_width=True):
            st.session_state.is_running = True
            st.rerun()
    with col2:
        if st.button("â¹ï¸ åœæ­¢", disabled=not st.session_state.is_running, type="secondary", use_container_width=True):
            st.session_state.is_running = False
            st.rerun()
    
    # çŠ¶æ€æ˜¾ç¤º
    status = "ğŸŸ¢ è¿è¡Œä¸­" if st.session_state.is_running else "ğŸ”´ å·²åœæ­¢"
    st.markdown(f"**çŠ¶æ€:** {status}")

# ==================== ç»Ÿè®¡åŒºåŸŸ ====================
st.subheader("ğŸ“Š å®æ—¶ç»Ÿè®¡")
col1, col2, col3 = st.columns(3)
col1.metric("ğŸ“¤ å·²å‘é€", st.session_state.send_count)
col2.metric("ğŸ“¥ å·²æ¥æ”¶", st.session_state.recv_count)
col3.metric("â±ï¸ å½“å‰é—´éš”", f"{interval}s")

# ==================== å‘é€/æ¥æ”¶è¯¦æƒ…åŒºåŸŸ ====================
st.markdown("---")

col_send, col_recv = st.columns(2)

# å·¦ä¾§ï¼šå‘é€ç«¯ä¿¡æ¯
with col_send:
    st.subheader("ğŸ“¤ å‘é€ç«¯è¯¦æƒ…")
    
    # å½“å‰é…ç½®
    with st.container():
        st.markdown("**å½“å‰é…ç½®:**")
        config_data = {
            "ç³»ç»Ÿ ID": f"{system_id}: {SYSTEM_ID_OPTIONS[system_id].split(': ')[1]}",
            "ç»„ä»¶ ID": f"{component_id}: {COMPONENT_ID_OPTIONS[component_id].split(': ')[1]}",
            "é£è¡Œå™¨ç±»å‹": f"{mav_type}: {MAV_TYPE[mav_type]}",
            "è‡ªåŠ¨é©¾é©¶ä»ª": "12: PX4",
            "åŸºç¡€æ¨¡å¼": 81,
            "ç³»ç»ŸçŠ¶æ€": "4: ACTIVE",
            "MAVLink ç‰ˆæœ¬": 3
        }
        st.json(config_data)
    
    # å‘é€æ—¥å¿—
    st.markdown("**å‘é€è®°å½•:**")
    send_container = st.container()
    with send_container:
        if st.session_state.send_log:
            for log in reversed(list(st.session_state.send_log)[-8:]):
                st.markdown(f"""
                <div style="background:#1E1E1E;padding:8px;margin:4px 0;border-radius:4px;font-family:monospace;font-size:12px;">
                <span style="color:#888;">[{log['time']}]</span> 
                <span style="color:#4CAF50;">âœ SEND</span> 
                SEQ:{log['seq']} | SYS:{log['sys']}({log['sys_meaning']}) | COMP:{log['comp']}({log['comp_meaning']})
                </div>
                """, unsafe_allow_html=True)
        else:
            st.info("ç­‰å¾…å‘é€...")

# å³ä¾§ï¼šæ¥æ”¶ç«¯ä¿¡æ¯
with col_recv:
    st.subheader("ğŸ“¥ æ¥æ”¶ç«¯è¯¦æƒ…")
    
    # æ¥æ”¶ç»Ÿè®¡
    with st.container():
        st.markdown("**æ¥æ”¶ç»Ÿè®¡:**")
        if st.session_state.recv_count > 0 and st.session_state.recv_log:
            latest = list(st.session_state.recv_log)[-1]
            recv_data = {
                "æœ€åæ¥æ”¶æ—¶é—´": latest['time'],
                "æ¥æºç³»ç»Ÿ": f"{latest['sys']}: {latest['sys_meaning']}",
                "æ¥æºç»„ä»¶": f"{latest['comp']}: {latest['comp_meaning']}",
                "é£è¡Œå™¨ç±»å‹": latest['type_name'],
                "ç³»ç»ŸçŠ¶æ€": latest['status_name'],
                "æ¶ˆæ¯åºåˆ—å·": latest['seq']
            }
            st.json(recv_data)
        else:
            st.json({"çŠ¶æ€": "ç­‰å¾…æ¥æ”¶..."})
    
    # æ¥æ”¶æ—¥å¿—
    st.markdown("**æ¥æ”¶è®°å½•:**")
    recv_container = st.container()
    with recv_container:
        if st.session_state.recv_log:
            for log in reversed(list(st.session_state.recv_log)[-8:]):
                st.markdown(f"""
                <div style="background:#1E1E1E;padding:8px;margin:4px 0;border-radius:4px;font-family:monospace;font-size:12px;">
                <span style="color:#888;">[{log['time']}]</span> 
                <span style="color:#2196F3;">â¬… RECV</span> 
                SEQ:{log['seq']} | SYS:{log['sys']} | {log['type_name']}
                </div>
                """, unsafe_allow_html=True)
        else:
            st.info("ç­‰å¾…æ¥æ”¶...")

# ==================== åŸå§‹æ•°æ®å±•ç¤º ====================
st.markdown("---")
st.subheader("ğŸ“¦ æœ€æ–°æ•°æ®åŒ… (HEX)")

hex_col1, hex_col2 = st.columns(2)
with hex_col1:
    if st.session_state.send_log:
        last_send = list(st.session_state.send_log)[-1]
        st.text_area("å‘é€æ•°æ®åŒ…", last_send['hex'], height=100, disabled=True)
    else:
        st.text_area("å‘é€æ•°æ®åŒ…", "æ— æ•°æ®", height=100, disabled=True)

with hex_col2:
    if st.session_state.recv_log:
        last_recv = list(st.session_state.recv_log)[-1]
        st.text_area("æ¥æ”¶æ•°æ®åŒ…", last_recv['hex'], height=100, disabled=True)
    else:
        st.text_area("æ¥æ”¶æ•°æ®åŒ…", "æ— æ•°æ®", height=100, disabled=True)

# ==================== é€šä¿¡å¾ªç¯ ====================
if st.session_state.is_running:
    # ç”Ÿæˆæ¨¡æ‹Ÿæ•°æ® - ä½¿ç”¨ç»Ÿä¸€çš„æ—¶é—´æˆ³
    seq = st.session_state.send_count + 1
    
    # è·å–å½“å‰ç³»ç»Ÿæ—¶é—´ï¼ˆç»Ÿä¸€æ—¶é—´æˆ³ï¼‰
    current_time = datetime.now()
    timestamp = current_time.strftime("%H:%M:%S.%f")[:-3]
    
    # è·å–å½“å‰é€‰æ‹©çš„å«ä¹‰
    sys_meaning = SYSTEM_ID_OPTIONS[system_id].split(': ')[1]
    comp_meaning = COMPONENT_ID_OPTIONS[component_id].split(': ')[1]
    
    # æ„å»ºæ¨¡æ‹Ÿ HEX æ•°æ®
    hex_data = f"FD 09 00 00 {seq % 256:02X} {system_id:02X} {component_id:02X} 00 00 00 {system_id:02X} 00 00 00 00 51 04 03 {mav_type:02X} 0C"
    
    # å‘é€æ—¥å¿— - ä½¿ç”¨ç»Ÿä¸€æ—¶é—´æˆ³
    send_entry = {
        'time': timestamp,
        'seq': seq,
        'sys': system_id,
        'sys_meaning': sys_meaning[:25],
        'comp': component_id,
        'comp_meaning': comp_meaning[:25],
        'hex': hex_data
    }
    st.session_state.send_log.append(send_entry)
    st.session_state.send_count += 1
    
    # æ¨¡æ‹Ÿç½‘ç»œå»¶è¿Ÿï¼ˆä½†æ—¶é—´æˆ³ä¿æŒä¸€è‡´ï¼‰
    time.sleep(0.1)
    
    # æ¥æ”¶æ—¥å¿— - ä½¿ç”¨ç›¸åŒçš„æ—¶é—´æˆ³ï¼ˆæ¨¡æ‹Ÿè‡ªå‘è‡ªæ”¶ï¼‰
    recv_entry = {
        'time': timestamp,  # ä½¿ç”¨ä¸å‘é€ç›¸åŒçš„æ—¶é—´æˆ³
        'seq': seq,
        'sys': system_id,
        'sys_meaning': sys_meaning,
        'comp': component_id,
        'comp_meaning': comp_meaning,
        'type_name': MAV_TYPE.get(mav_type, "UNKNOWN"),
        'status_name': MAV_STATE.get(4, "UNKNOWN"),
        'hex': hex_data
    }
    st.session_state.recv_log.append(recv_entry)
    st.session_state.recv_count += 1
    
    # ç»§ç»­å¾ªç¯
    time.sleep(max(0, interval - 0.1))
    st.rerun()

st.markdown("---")
st.caption("MAVLink Simulator | å‘é€ç«¯ âœ ç½‘ç»œ âœ æ¥æ”¶ç«¯")
